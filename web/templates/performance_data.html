{% extends "base.html" %}
{% block header %}
<script src="/static/js/chart.min.js"></script>
<script src="/static/js/chartjs-plugin-annotation.min.js"></script>

<script type="text/javascript">
function load_graph(){

  {% if 'perf_data' in service %}
  {% for p in service['perf_data']: %}
  $.ajax({type: 'GET', url: '/api/time/{{ p["id"] }}', success: function(data, status, request){
    const ctx = document.getElementById('graph-{{ p["id"] }}');

    data_array = [{
      label: '{{ p["id"] }}',
      data: data.values,
      borderWidth: 3,
      color: "#1181F1",
      fill: 'start'
    }]

    annotations = {}

    {% if 'warning' in p %}
    annotations['warning_line'] = {
      type: 'line',
      yMin: {{ p['warning'] }},
      yMax: {{ p['warning'] }},
      borderColor: '#EEC118',
      borderWidth: 2,
      label: {
        content: "Warning",
        color: '#EEC118'
      }
    }
    {% endif %}

    {% if 'critical' in p %}
    annotations['critical_line'] = {
      type: 'line',
      yMin: {{ p['critical'] }},
      yMax: {{ p['critical'] }},
      borderColor: '#EE2518',
      borderWidth: 2,
      label: {
        content: "Critical",
        color: '#EE2518'
      }
    }
    {% endif %}

    new Chart(ctx, {
      type: 'line',
      data: {
        labels: data.times,
        datasets: data_array
      },
      options: {
        {% if 'critical' in p or 'warning' in p %}
        plugins:{
          annotation:{
            annotations: annotations
          }
        },
        {% endif %}
        scales: {
          y: {
            beginAtZero: true,
            title: {
              display: true,
              text: '{{ p["uom"] }}',
              font: {
                size: 16,
                weight: "bold"
              }
            }
          }
        }
      }
    });
  }});
  {% endfor %}
  {% endif %}
}
</script>

{% endblock %}
{% block content %}
<div class="container">
  <div class="mt-2 pt-1" align="right">
    <a href="/status/host/{{ service['host']['id'] }}" class="btn btn-primary"><i class="mdi mdi-keyboard-return icon-sm icon-inline"></i> Host Status</a>
  </div>
  {% if 'perf_data' in service %}
  {% for p in service['perf_data']: %}
  <p class="mt-3"><b>Data point: {{ p['label'] }}</b></p>
  <canvas id="graph-{{ p['id'] }}" class="mb-4"></canvas>
  {% endfor %}
  {% endif %}
</div>
{% endblock %}
{% block onload_scripts %}
load_graph()
{% endblock %}
