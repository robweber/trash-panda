<html>
    <head>
        <title>Simple Monitoring</title>
        <link rel="stylesheet" href="/static/css/bootstrap.min.css" />
        <link rel="stylesheet" href="/static/css/bootstrap-theme.min.css" />
        <link rel="stylesheet" href="/static/css/materialdesignicons.min.css" />
        <link rel="stylesheet" href="/static/css/icons.css" />
        <script src="/static/js/jquery.min.js"></script>
        <script src="/static/js/popper.min.js"></script>
        <script src="/static/js/bootstrap.min.js"></script>
        <script type="text/javascript">

        function check_command_running(){
          // check if there is a system command running async from the browser
          $.ajax({type: 'GET', url: '/api/command/status', success: function(data, status, request){
            alertBox = $('#js-command-running');

            // if the command isn't complete, display the status
            if(data.progress != 100)
            {
              //something is running
              alertBox.text(data.status);

              //show alert if not already visible
              if(!alertBox.is(":visible"))
              {
                alertBox.show();
              }

              // check again in 15 seconds
              setTimeout(check_command_running, 15000);
            }
            else if(alertBox.is(":visible"))
            {
              //the command has completed
              alertBox.text(data.status);
              alertBox.toggleClass(["alert-primary", "alert-success"])
              alertBox.delay(2500).fadeOut();
            }
          }});
        }
        </script>
        {% block header %}{% endblock %}
    </head>
    <body>
        <div class="container">
        <div class="header clearfix">
          <div class="dropdown float-right">
            <a class="btn btn-secondary dropdown-toggle ml-3" href="/" role="button" id="configMenu" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              Config
            </a>
              <div class="dropdown-menu" aria-labelledby="configMenu">
                <a class="dropdown-item" href="/files">Files</a>
              </div>
          </div>
          <a class="btn btn-secondary float-right" href="/" role="button" id="statusMenu" aria-haspopup="false" aria-expanded="false">
            Status
          </a>
        <h3 class="text-muted"><span class="text-danger">Monitor</span> Dashboard</h3>
        </div>
        {% for category,message in get_flashed_messages(with_categories=true) %}
        <div class="alert alert-{{ category }}" role="alert">
            {{ message }}
        </div>
        {% endfor %}
        <div id="js-success-alert" class="alert alert-success" style="display:none" role="alert"></div>
        <div id="js-error-alert" class="alert alert-danger" style="display:none" role="alert"></div>
        <div id="js-command-running" class="alert alert-primary" style="display:none" role="alert"></div>
        {% block content %}{% endblock %}
        <script type="text/javascript">
          $(document).ready(function () {
            //run command check
            check_command_running();

            // unique page functions to load here
            {% block onload_scripts %}{% endblock %}
          });
        </script>
        <footer class="footer mt-5">
             <p align="center"><a href="https://github.com/robweber/simple-monitoring"><i class="mdi mdi-github icon-2x"></i></a></p>
        </footer>
    </body>
</html>
